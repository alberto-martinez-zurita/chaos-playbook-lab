<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaos Playbook Engine - Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* CSS Clean - Dobles llaves para evitar conflictos con Python .format() */
        :root { --primary: #4ECDC4; --secondary: #FF6B6B; --dark: #2d3748; --light: #f7fafc; --bg-gray: #f0f2f5; }
        
        /* Fondo gris suave para resaltar las tarjetas blancas */
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg-gray); padding: 40px; color: var(--dark); line-height: 1.5; }
        
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); overflow: hidden; }
        
        .header { background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%); color: white; padding: 40px; text-align: center; border-bottom: 4px solid var(--primary); }
        .header h1 { margin: 0; font-size: 2.5rem; letter-spacing: -1px; }
        .header p { opacity: 0.8; font-weight: 300; margin-top: 10px; font-size: 1.1rem; }
        
        .content { padding: 40px; background-color:#3f4f75 }
        .section { margin-bottom: 60px; }
        h2 { display: flex; align-items: center; gap: 10px; border-bottom: 2px solid #edf2f7; padding-bottom: 15px; margin-bottom: 30px; color: #FFFFFF; font-size: 1.5rem; }
        
        /* KPI Cards */
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .summary-card { background: #fff; padding: 25px; border-radius: 12px; border: 1px solid #edf2f7; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: transform 0.2s; }
        .summary-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); border-color: var(--primary); }
        .summary-card-label { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; color: #718096; font-weight: 600; margin-bottom: 10px; }
        .summary-card-value { font-size: 2rem; font-weight: 800; color: #1a202c; }
        
        /* Charts Grid - Rectangulares */
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(600px, 1fr)); gap: 30px; margin-bottom: 40px; }
        .chart-container { background: #fff; border: 1px solid #edf2f7; border-radius: 12px; padding: 20px; height: 350px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        
        /* Tables Layout */
        .summary-tables { display: grid; grid-template-columns: repeat(auto-fit, minmax(600px, 1fr)); gap: 30px; align-items: start; }
        
        /* Tables Style - Compact */
        .table-container { background: #fff; border-radius: 12px; border: 1px solid #edf2f7; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); overflow-x: auto; }
        h3 { margin: 0 0 20px 0; color: #4a5568; font-size: 1rem; font-weight: 700; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; } 
        th { background: #cee2ef ; color: #4a5568; padding: 12px 6px; text-align: center; font-weight: 700; border-bottom: 2px solid #edf2f7; white-space: nowrap; }
        th:first-child { text-align: left; background: #cee2ef; }
        td { padding: 10px 6px; border-bottom: 1px solid #edf2f7; color: #4a5568; text-align: center; white-space: nowrap; }
        td:first-child { text-align: left; font-weight: 600; color: #2d3748; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background-color: #f8fafc; }
        
        /* Detailed Grid - Ancho m칤nimo mayor para evitar scroll */
        .detailed-grid { grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); }
        .detailed-card { border-top: 4px solid var(--primary); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .badge { background: #edf2f7; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; color: #718096; }

        .footer { text-align: center; padding: 40px;  background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%); color: white; font-size: 0.9em; border-top: 1px solid #edf2f7 }
        
        /* Utils */
        .positive { color: #38a169; font-weight: 700; }
        .negative { color: #e53e3e; font-weight: 700; }
        .neutral { color: #a0aec0; }
        .improvement_class.positive { color: #38a169; }
        .improvement_class.negative { color: #e53e3e; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>游댧 Chaos Playbook Engine</h1>
            <p>Run: run_20251129_231224 | Generated: 2025-11-30 00:53:39</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>游늵 Executive Summary</h2>
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="summary-card-label">Max Effectiveness Gain</div>
                        <div class="summary-card-value positive">+55%</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-card-label">Avg Latency (Baseline)</div>
                        <div class="summary-card-value">3.43s</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-card-label">Avg Latency (Playbook)</div>
                        <div class="summary-card-value">4.60s</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-card-label">Avg Consistency</div>
                        <div class="summary-card-value">99%</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>游늳 Graphical Data</h2>
                <div class="charts-grid">
                    <div class="chart-container"><div id="effectiveness-chart" style="height:100%"></div></div>
                    <div class="chart-container"><div id="latency-chart" style="height:100%"></div></div>
                    <div class="chart-container"><div id="consistency-chart" style="height:100%"></div></div>
                    <div class="chart-container"><div id="combined-chart" style="height:100%"></div></div>
                </div>
            </div>

            <div class="section">
                <h2>游늶 Summary Data</h2>
                <div class="summary-tables"><div class="table-container"><h3>Success Rate</h3><table><tr><th>Agent</th><th>0%</th><th>1%</th><th>3%</th><th>5%</th><th>10%</th><th>15%</th><th>20%</th></tr><tr><td><strong>Baseline</strong></td><td>100%</td><td>95%</td><td>90%</td><td>75%</td><td>60%</td><td>30%</td><td>35%</td></tr><tr><td><strong>Playbook</strong></td><td>90%</td><td>85%</td><td>85%</td><td>90%</td><td>90%</td><td>85%</td><td>65%</td></tr><tr><td><strong>Delta</strong></td><td class="negative">-10%</td><td class="negative">-10%</td><td class="negative">-5%</td><td class="positive">+15%</td><td class="positive">+30%</td><td class="positive">+55%</td><td class="positive">+30%</td></tr></table></div><div class="table-container"><h3>Latency Overhead</h3><table><tr><th>Agent</th><th>0%</th><th>1%</th><th>3%</th><th>5%</th><th>10%</th><th>15%</th><th>20%</th></tr><tr><td><strong>Baseline</strong></td><td>3.59s</td><td>3.53s</td><td>3.43s</td><td>3.49s</td><td>3.19s</td><td>3.33s</td><td>3.43s</td></tr><tr><td><strong>Playbook</strong></td><td>3.40s</td><td>3.36s</td><td>3.40s</td><td>3.86s</td><td>4.94s</td><td>7.25s</td><td>5.98s</td></tr><tr><td><strong>Overhead</strong></td><td class="neutral">+-5%</td><td class="neutral">+-5%</td><td class="neutral">+-1%</td><td class="negative">+11%</td><td class="negative">+55%</td><td class="negative">+118%</td><td class="negative">+74%</td></tr></table></div><div class="table-container"><h3>Consistency Rate</h3><table><tr><th>Agent</th><th>0%</th><th>1%</th><th>3%</th><th>5%</th><th>10%</th><th>15%</th><th>20%</th></tr><tr><td><strong>Baseline</strong></td><td>100%</td><td>100%</td><td>90%</td><td>95%</td><td>100%</td><td>80%</td><td>90%</td></tr><tr><td><strong>Playbook</strong></td><td>100%</td><td>100%</td><td>100%</td><td>95%</td><td>100%</td><td>100%</td><td>95%</td></tr><tr><td><strong>Delta</strong></td><td class="neutral">+0%</td><td class="neutral">+0%</td><td class="positive">+10%</td><td class="neutral">+0%</td><td class="neutral">+0%</td><td class="positive">+20%</td><td class="positive">+5%</td></tr></table></div></div>
            </div>

            <div class="section">
                <h2>游댌 Detailed Data</h2>
                <div class="summary-tables detailed-grid">
        <div class="table-container detailed-card">
            <div class="card-header">
                <h3>Chaos Level: 0%</h3>
                <span class="badge">20 runs</span>
            </div>
            <table>
                <tr><th>Metric</th><th>Base</th><th>Playbook</th><th>Delta</th></tr>
                <tr>
                    <td>Success</td>
                    <td>100%</td><td>90%</td>
                    <td class="negative">-10%</td>
                </tr>
                <tr>
                    <td>Latency</td>
                    <td>3.59s</td><td>3.40s</td>
                    <td class="positive">+-5%</td>
                </tr>
                <tr>
                    <td>Consistency</td>
                    <td>100%</td><td>100%</td>
                    <td class="neutral">+0%</td>
                </tr>
            </table>
        </div>
        
        <div class="table-container detailed-card">
            <div class="card-header">
                <h3>Chaos Level: 1%</h3>
                <span class="badge">20 runs</span>
            </div>
            <table>
                <tr><th>Metric</th><th>Base</th><th>Playbook</th><th>Delta</th></tr>
                <tr>
                    <td>Success</td>
                    <td>95%</td><td>85%</td>
                    <td class="negative">-10%</td>
                </tr>
                <tr>
                    <td>Latency</td>
                    <td>3.53s</td><td>3.36s</td>
                    <td class="positive">+-5%</td>
                </tr>
                <tr>
                    <td>Consistency</td>
                    <td>100%</td><td>100%</td>
                    <td class="neutral">+0%</td>
                </tr>
            </table>
        </div>
        
        <div class="table-container detailed-card">
            <div class="card-header">
                <h3>Chaos Level: 3%</h3>
                <span class="badge">20 runs</span>
            </div>
            <table>
                <tr><th>Metric</th><th>Base</th><th>Playbook</th><th>Delta</th></tr>
                <tr>
                    <td>Success</td>
                    <td>90%</td><td>85%</td>
                    <td class="negative">-5%</td>
                </tr>
                <tr>
                    <td>Latency</td>
                    <td>3.43s</td><td>3.40s</td>
                    <td class="positive">+-1%</td>
                </tr>
                <tr>
                    <td>Consistency</td>
                    <td>90%</td><td>100%</td>
                    <td class="positive">+10%</td>
                </tr>
            </table>
        </div>
        
        <div class="table-container detailed-card">
            <div class="card-header">
                <h3>Chaos Level: 5%</h3>
                <span class="badge">20 runs</span>
            </div>
            <table>
                <tr><th>Metric</th><th>Base</th><th>Playbook</th><th>Delta</th></tr>
                <tr>
                    <td>Success</td>
                    <td>75%</td><td>90%</td>
                    <td class="positive">+15%</td>
                </tr>
                <tr>
                    <td>Latency</td>
                    <td>3.49s</td><td>3.86s</td>
                    <td class="negative">+11%</td>
                </tr>
                <tr>
                    <td>Consistency</td>
                    <td>95%</td><td>95%</td>
                    <td class="neutral">+0%</td>
                </tr>
            </table>
        </div>
        
        <div class="table-container detailed-card">
            <div class="card-header">
                <h3>Chaos Level: 10%</h3>
                <span class="badge">20 runs</span>
            </div>
            <table>
                <tr><th>Metric</th><th>Base</th><th>Playbook</th><th>Delta</th></tr>
                <tr>
                    <td>Success</td>
                    <td>60%</td><td>90%</td>
                    <td class="positive">+30%</td>
                </tr>
                <tr>
                    <td>Latency</td>
                    <td>3.19s</td><td>4.94s</td>
                    <td class="negative">+55%</td>
                </tr>
                <tr>
                    <td>Consistency</td>
                    <td>100%</td><td>100%</td>
                    <td class="neutral">+0%</td>
                </tr>
            </table>
        </div>
        
        <div class="table-container detailed-card">
            <div class="card-header">
                <h3>Chaos Level: 15%</h3>
                <span class="badge">20 runs</span>
            </div>
            <table>
                <tr><th>Metric</th><th>Base</th><th>Playbook</th><th>Delta</th></tr>
                <tr>
                    <td>Success</td>
                    <td>30%</td><td>85%</td>
                    <td class="positive">+55%</td>
                </tr>
                <tr>
                    <td>Latency</td>
                    <td>3.33s</td><td>7.25s</td>
                    <td class="negative">+118%</td>
                </tr>
                <tr>
                    <td>Consistency</td>
                    <td>80%</td><td>100%</td>
                    <td class="positive">+20%</td>
                </tr>
            </table>
        </div>
        
        <div class="table-container detailed-card">
            <div class="card-header">
                <h3>Chaos Level: 20%</h3>
                <span class="badge">20 runs</span>
            </div>
            <table>
                <tr><th>Metric</th><th>Base</th><th>Playbook</th><th>Delta</th></tr>
                <tr>
                    <td>Success</td>
                    <td>35%</td><td>65%</td>
                    <td class="positive">+30%</td>
                </tr>
                <tr>
                    <td>Latency</td>
                    <td>3.43s</td><td>5.98s</td>
                    <td class="negative">+74%</td>
                </tr>
                <tr>
                    <td>Consistency</td>
                    <td>90%</td><td>95%</td>
                    <td class="positive">+5%</td>
                </tr>
            </table>
        </div>
        </div>
            </div>
        </div>
        <div class="footer">Chaos Playbook Engine v5.0 - Validation Report</div>
    </div>

    <script>
        var failureRates = ["0%", "1%", "3%", "5%", "10%", "15%", "20%"];
        
        // Configuraci칩n Base de Ejes: Forzamos la l칤nea del eje X
        var layoutBase = {
            font: {family: 'Segoe UI, sans-serif'},
            plot_bgcolor: '#fff',
            paper_bgcolor: '#fff',
            margin: {t: 60, r: 20, l: 60, b: 40}, 
            legend: {orientation: 'h', x: 0.5, xanchor: 'center', y: 1.1, yanchor: 'top'},
            xaxis: {
                showline: true,      // Forzar l칤nea del eje X
                linewidth: 2,        // Grosor visible
                linecolor: '#E2E8F0', // Color gris claro pero visible
                mirror: true,        // L칤nea en el borde superior tambi칠n (opcional)
                tickfont: {size: 10}
            },
            yaxis: {
                showgrid: true,
                gridcolor: '#F7FAFC'
            }
        };

        // Gr치fico 1: Success Rate
        var layoutSuccess = JSON.parse(JSON.stringify(layoutBase)); // Clonar
        layoutSuccess.title = 'Success Rate';
        layoutSuccess.barmode = 'group';
        
        Plotly.newPlot('effectiveness-chart', [
            { x: failureRates, y: [1.0, 0.95, 0.9, 0.75, 0.6, 0.3, 0.35], name: 'Baseline', type: 'bar', marker: {color: '#FF6B6B'} },
            { x: failureRates, y: [0.9, 0.85, 0.85, 0.9, 0.9, 0.85, 0.65], name: 'Playbook', type: 'bar', marker: {color: '#4ECDC4'} }
        ], layoutSuccess, {responsive: true});

        // Gr치fico 2: Latency
        var layoutLatency = JSON.parse(JSON.stringify(layoutBase));
        layoutLatency.title = 'Latency Overhead';
        
        Plotly.newPlot('latency-chart', [
            { x: [0.0, 0.01, 0.03, 0.05, 0.1, 0.15, 0.2], y: [-5.425594094955022, -4.704265662520035, -0.8253365450343386, 10.659824093127913, 54.81264185573842, 117.65911453438034, 73.99834201103515], name: 'Overhead %', mode: 'lines+markers', line: {color: '#FF6B6B'} }
        ], layoutLatency, {responsive: true});

        // Gr치fico 3: Consistency - CON EJE X FORZADO
        var layoutConsistency = JSON.parse(JSON.stringify(layoutBase));
        layoutConsistency.title = 'Data Consistency';
        // Aseguramos rango [0, 105] para que 100 no quede pegado al techo
        layoutConsistency.yaxis.range = [0, 105]; 
        
        Plotly.newPlot('consistency-chart', [
            { x: [0.0, 0.01, 0.03, 0.05, 0.1, 0.15, 0.2], y: [100.0, 100.0, 90.0, 95.0, 100.0, 80.0, 90.0], name: 'Baseline', mode: 'lines+markers', line: {color: '#FF6B6B'} },
            { x: [0.0, 0.01, 0.03, 0.05, 0.1, 0.15, 0.2], y: [100.0, 100.0, 100.0, 95.0, 100.0, 100.0, 95.0], name: 'Playbook', mode: 'lines+markers', line: {color: '#4ECDC4'} }
        ], layoutConsistency, {responsive: true});
        
        // Gr치fico 4: ROI
        var benefitTrace = {
            x: [0.0, 0.01, 0.03, 0.05, 0.1, 0.15, 0.2], y: [-9.999999999999998, -9.999999999999998, -5.000000000000004, 15.000000000000002, 30.000000000000004, 55.00000000000001, 30.000000000000004], name: 'Benefit (Success Gain)',
            type: 'scatter', mode: 'lines', fill: 'tozeroy', line: {color: '#4ECDC4'}
        };
        var costTrace = {
            x: [0.0, 0.01, 0.03, 0.05, 0.1, 0.15, 0.2], y: [-5.425594094955022, -4.704265662520035, -0.8253365450343386, 10.659824093127913, 54.81264185573842, 117.65911453438034, 73.99834201103515], name: 'Cost (Latency)',
            yaxis: 'y2', type: 'scatter', mode: 'lines+markers', line: {color: '#FF6B6B', dash: 'dot'}
        };
        
        // Combinar layout base con eje Y secundario
        var layoutCombined = JSON.parse(JSON.stringify(layoutBase));
        layoutCombined.title = 'ROI Analysis';
        layoutCombined.yaxis = {title: 'Gain (pp)', titlefont: {color: '#4ECDC4'}, tickfont: {color: '#4ECDC4'}, showline: true, linewidth: 2, linecolor: '#E2E8F0'};
        layoutCombined.yaxis2 = {title: 'Latency (%)', titlefont: {color: '#FF6B6B'}, tickfont: {color: '#FF6B6B'}, overlaying: 'y', side: 'right', showgrid: false};
        
        Plotly.newPlot('combined-chart', [benefitTrace, costTrace], layoutCombined, {responsive: true});
    </script>
</body>
</html>